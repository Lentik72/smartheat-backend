!function(){"use strict";const e={10501:"Westchester County",10502:"Westchester County",10503:"Westchester County",10504:"Westchester County",10505:"Westchester County",10506:"Westchester County",10507:"Westchester County",10509:"Westchester County",10510:"Westchester County",10514:"Westchester County",10516:"Westchester County",10517:"Westchester County",10518:"Westchester County",10519:"Westchester County",10520:"Westchester County",10521:"Westchester County",10522:"Westchester County",10523:"Westchester County",10524:"Westchester County",10526:"Westchester County",10527:"Westchester County",10528:"Westchester County",10530:"Westchester County",10532:"Westchester County",10533:"Westchester County",10535:"Westchester County",10536:"Westchester County",10537:"Westchester County",10538:"Westchester County",10540:"Westchester County",10541:"Westchester County",10543:"Westchester County",10545:"Westchester County",10546:"Westchester County",10547:"Westchester County",10548:"Westchester County",10549:"Westchester County",10550:"Westchester County",10552:"Westchester County",10553:"Westchester County",10560:"Westchester County",10562:"Westchester County",10566:"Westchester County",10567:"Westchester County",10570:"Westchester County",10573:"Westchester County",10576:"Westchester County",10577:"Westchester County",10578:"Westchester County",10580:"Westchester County",10583:"Westchester County",10588:"Westchester County",10589:"Westchester County",10590:"Westchester County",10591:"Westchester County",10594:"Westchester County",10595:"Westchester County",10597:"Westchester County",10598:"Westchester County",10601:"Westchester County",10603:"Westchester County",10604:"Westchester County",10605:"Westchester County",10606:"Westchester County",10607:"Westchester County",10701:"Westchester County",10703:"Westchester County",10704:"Westchester County",10705:"Westchester County",10706:"Westchester County",10707:"Westchester County",10708:"Westchester County",10709:"Westchester County",10710:"Westchester County",10801:"Westchester County",10803:"Westchester County",10804:"Westchester County",10805:"Westchester County",11701:"Suffolk County",11702:"Suffolk County",11703:"Suffolk County",11704:"Suffolk County",11705:"Suffolk County",11706:"Suffolk County",11713:"Suffolk County",11715:"Suffolk County",11716:"Suffolk County",11717:"Suffolk County",11718:"Suffolk County",11719:"Suffolk County",11720:"Suffolk County",11721:"Suffolk County",11722:"Suffolk County",11724:"Suffolk County",11725:"Suffolk County",11726:"Suffolk County",11727:"Suffolk County",11729:"Suffolk County",11730:"Suffolk County",11731:"Suffolk County",11733:"Suffolk County",11738:"Suffolk County",11739:"Suffolk County",11740:"Suffolk County",11741:"Suffolk County",11742:"Suffolk County",11743:"Suffolk County",11746:"Suffolk County",11747:"Suffolk County",11749:"Suffolk County",11751:"Suffolk County",11752:"Suffolk County",11754:"Suffolk County",11755:"Suffolk County",11757:"Suffolk County",11758:"Suffolk County",11763:"Suffolk County",11764:"Suffolk County",11766:"Suffolk County",11767:"Suffolk County",11768:"Suffolk County",11769:"Suffolk County",11770:"Suffolk County",11772:"Suffolk County",11776:"Suffolk County",11777:"Suffolk County",11778:"Suffolk County",11779:"Suffolk County",11780:"Suffolk County",11782:"Suffolk County",11784:"Suffolk County",11786:"Suffolk County",11787:"Suffolk County",11788:"Suffolk County",11789:"Suffolk County",11790:"Suffolk County",11792:"Suffolk County",11794:"Suffolk County",11795:"Suffolk County",11796:"Suffolk County",11798:"Suffolk County",11001:"Nassau County",11002:"Nassau County",11003:"Nassau County",11010:"Nassau County",11020:"Nassau County",11021:"Nassau County",11023:"Nassau County",11024:"Nassau County",11030:"Nassau County",11040:"Nassau County",11042:"Nassau County",11050:"Nassau County",11096:"Nassau County",11501:"Nassau County",11507:"Nassau County",11509:"Nassau County",11510:"Nassau County",11514:"Nassau County",11516:"Nassau County",11518:"Nassau County",11520:"Nassau County",11530:"Nassau County",11542:"Nassau County",11545:"Nassau County",11548:"Nassau County",11549:"Nassau County",11550:"Nassau County",11552:"Nassau County",11553:"Nassau County",11554:"Nassau County",11556:"Nassau County",11557:"Nassau County",11558:"Nassau County",11559:"Nassau County",11560:"Nassau County",11561:"Nassau County",11563:"Nassau County",11565:"Nassau County",11566:"Nassau County",11568:"Nassau County",11569:"Nassau County",11570:"Nassau County",11572:"Nassau County",11575:"Nassau County",11576:"Nassau County",11577:"Nassau County",11579:"Nassau County",11580:"Nassau County",11581:"Nassau County",11590:"Nassau County",11596:"Nassau County",11598:"Nassau County",11599:"Nassau County","06601":"Fairfield County","06604":"Fairfield County","06605":"Fairfield County","06606":"Fairfield County","06607":"Fairfield County","06608":"Fairfield County","06610":"Fairfield County","06611":"Fairfield County","06612":"Fairfield County","06614":"Fairfield County","06615":"Fairfield County","06776":"Fairfield County","06801":"Fairfield County","06804":"Fairfield County","06807":"Fairfield County","06810":"Fairfield County","06811":"Fairfield County","06812":"Fairfield County","06820":"Fairfield County","06824":"Fairfield County","06825":"Fairfield County","06828":"Fairfield County","06830":"Fairfield County","06831":"Fairfield County","06840":"Fairfield County","06850":"Fairfield County","06851":"Fairfield County","06853":"Fairfield County","06854":"Fairfield County","06855":"Fairfield County","06856":"Fairfield County","06857":"Fairfield County","06858":"Fairfield County","06870":"Fairfield County","06877":"Fairfield County","06878":"Fairfield County","06880":"Fairfield County","06883":"Fairfield County","06888":"Fairfield County","06889":"Fairfield County","06896":"Fairfield County","06897":"Fairfield County"},t=document.getElementById("zip-form"),n=document.getElementById("zip-input"),o=document.getElementById("check-btn"),s=document.getElementById("loading-state"),a=document.getElementById("results-section"),i=document.getElementById("empty-state"),r=document.getElementById("error-state"),u=document.getElementById("app-cta"),l=document.getElementById("share-btn"),c=document.getElementById("share-feedback"),d=document.getElementById("retry-btn"),p=document.getElementById("bookmark-hint"),y=document.getElementById("price-movement"),f=document.getElementById("prices-trust"),C=document.getElementById("default-leaderboard"),m=document.getElementById("pulse-suppliers"),h=document.getElementById("pulse-states");let g="",k=[],v=Date.now(),S=0;function w(e){e.preventDefault();const t=n.value.trim();/^\d{5}$/.test(t)?b(t):F("Please enter a valid 5-digit ZIP code.")}function $(){g&&b(g)}async function b(t){g=t,localStorage.setItem("homeheat_last_zip",t);const n=new URL(window.location);n.searchParams.set("zip",t),window.history.replaceState({},"",n),N("loading"),o.disabled=!0,o.textContent="Loading...";try{const n=await fetch(`/api/v1/suppliers?zip=${t}`);if(!n.ok)throw new Error(`API error: ${n.status}`);const o=await n.json();if(o.data&&o.data.length>0){const n=o.data.filter(e=>e.currentPrice&&e.currentPrice.pricePerGallon),s=o.data.filter(e=>!e.currentPrice||!e.currentPrice.pricePerGallon);n.length>0?(k=n,function(t,n,o=[]){n.sort((e,t)=>e.currentPrice.pricePerGallon-t.currentPrice.pricePerGallon);const s=n.map(e=>e.currentPrice.pricePerGallon),a=Math.min(...s),i=Math.max(...s),r=i-a,u=Math.round(200*r),l=e[t],c=l?`${l} (${t})`:`ZIP ${t}`;document.getElementById("result-location").textContent=c,document.getElementById("lowest-price").textContent=`$${a.toFixed(2)}`,document.getElementById("highest-price").textContent=`$${i.toFixed(2)}`;const d=document.getElementById("savings-potential");u>0?(d.innerHTML=`Save up to <strong>$${u}</strong> on 200 gallons`,d.style.display="block"):d.style.display="none";const C=n.reduce((e,t)=>{const n=t.currentPrice.scrapedAt?new Date(t.currentPrice.scrapedAt):null;return n&&n>e?n:e},new Date(0));document.getElementById("freshness").textContent=function(e){if(!e||0===e.getTime())return"Updated recently";const t=new Date-e,n=Math.floor(t/36e5),o=Math.floor(t/864e5);return n<1?"Updated just now":1===n?"Updated 1 hour ago":n<24?`Updated ${n} hours ago`:1===o?"Updated yesterday":o<7?`Updated ${o} days ago`:`Updated ${e.toLocaleDateString()}`}(C);const m=document.getElementById("supplier-cards");let h=n.map(e=>function(e){const t=e.currentPrice,n=e.phone||"",o=n.replace(/\D/g,""),s=function(e){if(!e||0===e.getTime())return"Updated recently";const t=new Date-e,n=Math.floor(t/36e5),o=Math.floor(t/864e5);return n<1?"Updated now":n<24?`${n}h ago`:1===o?"Yesterday":o<7?`${o}d ago`:e.toLocaleDateString("en-US",{month:"short",day:"numeric"})}(t.scrapedAt?new Date(t.scrapedAt):null),a=e.website&&e.website.startsWith("https://");return`\n      <div class="supplier-card">\n        <div class="supplier-info">\n          <div class="supplier-name">\n            ${e.slug?`<a href="/supplier/${e.slug}" class="supplier-profile-link">${P(e.name)}</a>`:P(e.name)}\n          </div>\n          <div class="supplier-location">${P(e.city||"")}, ${P(e.state||"")}</div>\n          <div class="supplier-actions">\n            ${n?`<a href="tel:${o}" class="supplier-phone" data-track-supplier-id="${e.id}" data-track-supplier-name="${P(e.name)}" data-track-action="call">Call ${P(n)}</a>`:""}\n            ${a?`<a href="${P(e.website)}" target="_blank" rel="noopener noreferrer" referrerpolicy="no-referrer" class="supplier-website-btn" data-track-supplier-id="${e.id}" data-track-supplier-name="${P(e.name)}" data-track-action="website">Visit Website</a>`:""}\n          </div>\n        </div>\n        <div class="supplier-price">\n          <div class="price-amount">$${t.pricePerGallon.toFixed(2)}</div>\n          <div class="price-unit">per gallon</div>\n          ${t.minGallons?`<div class="price-min">${t.minGallons}+ gal min</div>`:""}\n          <div class="price-freshness">${s}</div>\n        </div>\n      </div>\n    `}(e)).join("");o.length>0&&(h+=`\n        <div class="unpriced-section">\n          <h3 class="unpriced-heading">Other Suppliers in Your Area</h3>\n          <p class="unpriced-subtitle">Call for current pricing</p>\n          ${o.map(e=>W(e)).join("")}\n        </div>\n      `);m.innerHTML=h,sessionStorage.getItem("homeheat_bookmark_shown")||(p.style.display="block",sessionStorage.setItem("homeheat_bookmark_shown","true"));y.style.display="none",function(e,t){const n=`homeheat_price_${e}`,o=localStorage.getItem(n);if(o)try{const{price:n,timestamp:s}=JSON.parse(o),a=(Date.now()-s)/864e5;if(a>=1&&a<=14){const o=t-n,s=Math.abs(Math.round(100*o));if(s>=2){const t=document.getElementById("movement-icon"),n=document.getElementById("movement-text");o>0?(y.className="price-movement movement-up",t.textContent="↑",n.textContent=`Prices up ${s}¢ since last check`):(y.className="price-movement movement-down",t.textContent="↓",n.textContent=`Prices down ${s}¢ since last check`),y.style.display="flex",B("price_movement_shown",{zip:e,diff:s,direction:o>0?"up":"down"})}else y.className="price-movement movement-flat",document.getElementById("movement-icon").textContent="→",document.getElementById("movement-text").textContent="Prices stable since last check",y.style.display="flex"}}catch(e){console.error("Error parsing cached price:",e)}localStorage.setItem(n,JSON.stringify({price:t,timestamp:Date.now()}))}(t,a),g=n.length,void(f&&g>0&&(f.textContent=`Based on live pricing from ${g} verified supplier${g>1?"s":""} in your area.`)),function(t,n){const o=document.getElementById("schema-markup");if(!o||0===n.length)return;const s=e[t]||"",a=s?`${s} (${t})`:`ZIP ${t}`,i=n.slice(0,10).map((e,t)=>({"@type":"ListItem",position:t+1,item:{"@type":"Service",name:`Heating Oil Delivery from ${e.name}`,description:`Heating oil delivery service from ${e.name}. Current price: $${e.currentPrice.pricePerGallon.toFixed(2)} per gallon.`,image:"https://www.gethomeheat.com/images/app-icon.png",serviceType:"Heating Oil Delivery",areaServed:a,provider:{"@type":"LocalBusiness",name:e.name,image:"https://www.gethomeheat.com/images/app-icon.png",address:{"@type":"PostalAddress",addressLocality:e.city||"",addressRegion:e.state||""},telephone:e.phone||"",priceRange:`$${e.currentPrice.pricePerGallon.toFixed(2)}/gal`},priceSpecification:{"@type":"UnitPriceSpecification",price:e.currentPrice.pricePerGallon.toFixed(2),priceCurrency:"USD",unitCode:"GLL",unitText:"gallon"}}})),r={"@context":"https://schema.org","@type":"WebPage",name:`Heating Oil Prices in ${a}`,description:`Compare current heating oil prices from ${n.length} local suppliers in ${a}.`,publisher:{"@type":"Organization",name:"HomeHeat",url:"https://gethomeheat.com"},mainEntity:{"@type":"ItemList",name:`Heating Oil Prices in ${a}`,description:`Current heating oil prices from local suppliers serving ${a}`,numberOfItems:n.length,itemListElement:i}};o.textContent=JSON.stringify(r)}(t,n),"function"==typeof window.showPwaInstallBanner&&setTimeout(()=>window.showPwaInstallBanner(),1500);var g}(t,n,s),N("results"),B("price_lookup",{zip:t,count:n.length,unpricedCount:s.length})):s.length>0?(k=[],function(t,n){const o=e[t],s=o?`${o} (${t})`:`ZIP ${t}`;document.getElementById("result-location").textContent=s,document.getElementById("lowest-price").textContent="Call",document.getElementById("highest-price").textContent="Call";const a=document.getElementById("savings-potential");a.innerHTML=`<strong>${n.length}</strong> supplier${n.length>1?"s":""} serve this area`,a.style.display="block",document.getElementById("freshness").textContent="Call for prices";document.getElementById("supplier-cards").innerHTML=`\n      <div class="unpriced-notice">\n        <p>We don't have current pricing for suppliers in this area yet. Contact them directly for quotes.</p>\n      </div>\n      ${n.map(e=>W(e)).join("")}\n    `,sessionStorage.getItem("homeheat_bookmark_shown")||(p.style.display="block",sessionStorage.setItem("homeheat_bookmark_shown","true"))}(t,s),N("results"),B("price_lookup_unpriced_only",{zip:t,count:s.length})):(E(t),B("price_lookup_empty",{zip:t,reason:"no_prices"}))}else E(t),B("price_lookup_empty",{zip:t,reason:"no_suppliers"})}catch(e){console.error("Price lookup failed:",e),F("We couldn't load prices right now. Please try again."),B("price_lookup_error",{zip:t,error:e.message})}finally{o.disabled=!1,o.textContent="Check Prices"}}function W(e){const t=e.phone||"",n=t.replace(/\D/g,""),o=e.website&&e.website.startsWith("https://");return`\n      <div class="supplier-card supplier-card-unpriced">\n        <div class="supplier-info">\n          <div class="supplier-name">\n            ${e.slug?`<a href="/supplier/${e.slug}" class="supplier-profile-link">${P(e.name)}</a>`:P(e.name)}\n          </div>\n          <div class="supplier-location">${P(e.city||"")}, ${P(e.state||"")}</div>\n          <div class="supplier-actions">\n            ${t?`<a href="tel:${n}" class="supplier-phone" data-track-supplier-id="${e.id}" data-track-supplier-name="${P(e.name)}" data-track-action="call">Call ${P(t)}</a>`:""}\n            ${o?`<a href="${P(e.website)}" target="_blank" rel="noopener noreferrer" referrerpolicy="no-referrer" class="supplier-website-btn" data-track-supplier-id="${e.id}" data-track-supplier-name="${P(e.name)}" data-track-action="website">Visit Website</a>`:""}\n          </div>\n        </div>\n        <div class="supplier-price supplier-price-unpriced">\n          <div class="price-amount">Call</div>\n          <div class="price-unit">for price</div>\n        </div>\n      </div>\n    `}async function I(){if(0===k.length)return;const t=k.map(e=>e.currentPrice.pricePerGallon),n=Math.min(...t).toFixed(2),o=Math.max(...t).toFixed(2),s=e[g],a=s?`${s} (${g})`:`near ${g}`,i=`Heating oil in ${a} is $${n}–$${o} today. Check your ZIP: gethomeheat.com/prices.html?zip=${g}`,r=`https://gethomeheat.com/prices.html?zip=${g}`;if(navigator.share&&/Mobi|Android/i.test(navigator.userAgent))try{return await navigator.share({title:`Heating Oil Prices in ${a}`,text:i,url:r}),void B("share_native",{zip:g})}catch(e){}navigator.clipboard.writeText(i).then(()=>{c.textContent="Copied!",c.style.display="inline",setTimeout(()=>{c.style.display="none"},2e3),B("share_clipboard",{zip:g})}).catch(()=>{c.textContent="Copy failed",c.style.display="inline"})}function N(e){switch(s.style.display="none",a.style.display="none",i.style.display="none",r.style.display="none",u.style.display="none",e){case"loading":s.style.display="block";break;case"results":a.style.display="block",u.style.display="block",C&&(C.style.opacity="0",setTimeout(()=>{C.style.display="none"},300));break;case"empty":i.style.display="block",u.style.display="block",C&&(C.style.opacity="0",setTimeout(()=>{C.style.display="none"},300));break;case"error":r.style.display="block",C&&(C.style.opacity="0",setTimeout(()=>{C.style.display="none"},300))}}function E(t){document.getElementById("empty-zip").textContent=t,function(t){const n=function(t){const n=t.substring(0,3),o=parseInt(t,10),s=new Set;for(let e=-5;e<=5;e++){if(0===e)continue;const a=(o+e).toString().padStart(5,"0");a.startsWith(n)&&a!==t&&s.add(a)}const a=parseInt(n,10);[a-1,a+1].forEach(e=>{if(e>=0&&e<=999){const n=e.toString().padStart(3,"0")+t.substring(3);n!==t&&s.add(n)}});return Array.from(s).sort((t,n)=>(e[n]?1:0)-(e[t]?1:0)).slice(0,4)}(t),o=document.getElementById("nearby-zips"),s=document.getElementById("nearby-zip-buttons");n.length>0&&o&&s&&(s.innerHTML=n.map(e=>`<button class="nearby-zip-btn" data-nearby-zip="${e}">${e}</button>`).join(""),o.style.display="block")}(t),N("empty")}function F(e){document.getElementById("error-message").textContent=e,N("error")}function P(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function B(e,t){"function"==typeof gtag&&gtag("event",e,t||{})}function x(){B("page_exit",{timeOnPageSeconds:Math.round((Date.now()-v)/1e3),zip:g||null})}window.lookupZip=function(e){n.value=e,b(e)},window.trackWebsiteClick=function(e,t){const n=Date.now();if(n-S<500)return;S=n;const o=/Mobi|Android/i.test(navigator.userAgent),s=/Android/i.test(navigator.userAgent),a=JSON.stringify({supplierId:e,supplierName:t,action:"website",zipCode:g||null,pageSource:"prices",deviceType:o?"mobile":"desktop",platform:s?"android":o?"ios":"web"});navigator.sendBeacon?navigator.sendBeacon("/api/log-action",new Blob([a],{type:"application/json"})):fetch("/api/log-action",{method:"POST",headers:{"Content-Type":"application/json"},body:a,keepalive:!0}).catch(function(e){console.error("[Tracking] Website click failed:",e)}),"function"==typeof gtag&&gtag("event","supplier_outbound_click",{supplier_id:e,supplier_name:t,zip_code:g||""})},window.trackCallClick=function(e,t){const n=Date.now();if(n-S<500)return;S=n;const o=/Mobi|Android/i.test(navigator.userAgent),s=/Android/i.test(navigator.userAgent),a=JSON.stringify({supplierId:e,supplierName:t,action:"call",zipCode:g||null,pageSource:"prices",deviceType:o?"mobile":"desktop",platform:s?"android":o?"ios":"web"});navigator.sendBeacon?navigator.sendBeacon("/api/log-action",new Blob([a],{type:"application/json"})):fetch("/api/log-action",{method:"POST",headers:{"Content-Type":"application/json"},body:a,keepalive:!0}).catch(function(e){console.error("[Tracking] Call click failed:",e)}),"function"==typeof gtag&&gtag("event","supplier_call_click",{supplier_id:e,supplier_name:t,zip_code:g||""})},document.addEventListener("click",function(e){var t=e.target.closest("a[data-track-supplier-id]");if(t){var n=t.getAttribute("data-track-supplier-id"),o=t.getAttribute("data-track-supplier-name"),s=t.getAttribute("data-track-action");n&&o&&s&&("call"===s?window.trackCallClick(n,o):"website"===s&&window.trackWebsiteClick(n,o))}else{var a=e.target.closest("button[data-nearby-zip]");if(a){var i=a.getAttribute("data-nearby-zip");i&&window.lookupZip(i)}}}),function(){!async function(){try{const e=await fetch("/api/market/pulse");if(!e.ok)return;const t=await e.json();m&&t.supplierCount&&(m.textContent=t.supplierCount+"+"),h&&t.stateCount&&(h.textContent=t.stateCount),f&&t.supplierCount&&(f.textContent="Tracking prices from "+t.supplierCount+"+ active heating oil suppliers in our network.")}catch(e){}}(),async function(){try{const e=await fetch("/api/market/leaderboard");if(!e.ok)return;const t=await e.json(),n=document.getElementById("leaderboard-date");n&&t.generatedAt&&(n.textContent="Updated "+t.generatedAt);const o=document.querySelector(".averages-table tbody");if(o&&t.stateAverages&&t.stateAverages.length>0){const e=t.stateAverages.map(function(e){e.stateName.toLowerCase().replace(/\s+/g,"-");const t=e.state.toLowerCase();return'<tr><td><a href="prices/'+t+'/">'+P(e.stateName)+"</a></td><td>$"+e.avgPrice.toFixed(2)+" avg</td><td>"+e.supplierCount+' suppliers</td><td><a href="prices/'+t+'/">See all →</a></td></tr>'}).join("\n");o.innerHTML=e}const s=document.querySelector(".deals-list");if(s&&t.topDeals&&t.topDeals.length>0){const e=t.topDeals.map(function(e){return'<li class="deal-item"><span class="deal-price">$'+e.price+'/gal</span><span class="deal-supplier">'+P(e.supplierName)+'</span><span class="deal-location">'+P(e.city)+", "+e.state+"</span></li>"}).join("\n");s.innerHTML=e}}catch(e){}}(),function(){const e="homeheat_visits",t="homeheat_last_visit",n=parseInt(localStorage.getItem(e)||"0",10)+1,o=localStorage.getItem(t),s=Date.now();localStorage.setItem(e,n.toString()),localStorage.setItem(t,s.toString());const a=o&&s-parseInt(o,10)>864e5;B("page_view",{visits:n,isReturn:a,daysSinceLastVisit:o?Math.round((s-parseInt(o,10))/864e5):null})}(),window.addEventListener("beforeunload",x);const e=new URLSearchParams(window.location.search).get("zip"),o=localStorage.getItem("homeheat_last_zip");e&&/^\d{5}$/.test(e)?(n.value=e,b(e)):o&&/^\d{5}$/.test(o)&&(n.value=o),t.addEventListener("submit",w),l.addEventListener("click",I),d.addEventListener("click",$),n.addEventListener("input",e=>{e.target.value=e.target.value.replace(/\D/g,"").slice(0,5)})}(),/Android/i.test(navigator.userAgent)&&document.querySelectorAll(".ios-only").forEach(function(e){e.style.display="none"})}();