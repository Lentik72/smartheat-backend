(function(){"use strict";const s=document.getElementById("demand-stats");if(!s)return;const f=s.dataset.slug,l=parseInt(s.dataset.ts,10)*1e3,e=document.getElementById("claim-form");if(!e)return;const n=document.getElementById("claim-submit"),o=document.getElementById("form-error"),c=document.getElementById("claim-success");function t(r){o.textContent=r,o.style.display="block",n.disabled=!1,n.textContent="Claim My Listing"}function p(){o.style.display="none"}e.addEventListener("submit",async function(r){r.preventDefault(),p();const m=e.claimantName.value.trim(),i=e.claimantEmail.value.trim(),g=e.claimantPhone.value.trim(),h=e.claimantRole.value,b=e.website_url.value;if(!m)return t("Please enter your name.");if(!i)return t("Please enter your email.");if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i))return t("Please enter a valid email address.");const u=Date.now()-l;if(u<3e3)return t("Please wait a moment before submitting.");if(u>18e5)return t("This page has expired. Please refresh and try again.");n.disabled=!0,n.textContent="Submitting...";try{const a=await fetch("/api/supplier-claim",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({slug:f,claimantName:m,claimantEmail:i,claimantPhone:g||null,claimantRole:h,website_url:b,ts:Math.floor(l/1e3)})}),d=await a.json();if(a.ok&&d.success){e.closest(".claim-form-card").style.display="none";const y=document.querySelector(".claim-benefits-card");y&&(y.style.display="none"),c.style.display="block",c.scrollIntoView({behavior:"smooth",block:"center"})}else a.status===429?t("Too many attempts. Please try again tomorrow."):t(d.error||"Something went wrong. Please try again.")}catch(a){t("Connection error. Please check your internet and try again.")}})})();
