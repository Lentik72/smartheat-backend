(function(){"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").catch(()=>{});let t=null;if(!/Android/i.test(navigator.userAgent)||window.matchMedia("(display-mode: standalone)").matches)return;function r(){const e=localStorage.getItem("pwa-banner-dismissed");if(!e)return!1;const a=parseInt(e,10),c=4320*60*1e3;return Date.now()-a<c}function l(){return parseInt(localStorage.getItem("pwa-visit-count")||"0",10)}function d(){let e=l()+1;return localStorage.setItem("pwa-visit-count",e.toString()),e}window.addEventListener("beforeinstallprompt",e=>{t=e,typeof gtag=="function"&&gtag("event","pwa_prompt_ready",{platform:"android"})});function n(){if(!t||r()||document.getElementById("pwa-install-banner"))return;const e=document.createElement("div");e.id="pwa-install-banner",e.innerHTML=`
      <div class="pwa-banner-card">
        <button class="pwa-dismiss" aria-label="Close">&times;</button>
        <div class="pwa-banner-content">
          <img src="/images/app-icon.png" alt="HomeHeat" class="pwa-icon">
          <div class="pwa-text">
            <strong>Save HomeHeat</strong>
            <span>See today's prices. Plan ahead.</span>
          </div>
        </div>
        <button class="pwa-install-btn">Add HomeHeat</button>
      </div>
    `,document.body.appendChild(e),requestAnimationFrame(()=>{e.classList.add("visible")}),typeof gtag=="function"&&gtag("event","pwa_banner_shown",{platform:"android"}),e.querySelector(".pwa-install-btn").addEventListener("click",async()=>{e.classList.remove("visible"),setTimeout(()=>e.remove(),300),t.prompt();const{outcome:a}=await t.userChoice;typeof gtag=="function"&&gtag("event",a==="accepted"?"pwa_installed":"pwa_install_declined",{platform:"android"}),t=null}),e.querySelector(".pwa-dismiss").addEventListener("click",()=>{e.classList.remove("visible"),setTimeout(()=>e.remove(),300),localStorage.setItem("pwa-banner-dismissed",Date.now().toString()),typeof gtag=="function"&&gtag("event","pwa_banner_dismissed",{platform:"android"})})}window.showPwaInstallBanner=n;const i=d();i>=2&&setTimeout(()=>{n()},3e3),i===1&&setTimeout(()=>{n()},15e3);let s=0,o=0;window.addEventListener("scroll",()=>{window.scrollY<s-100&&(o++,o>=2&&n()),s=window.scrollY},{passive:!0}),window.addEventListener("appinstalled",()=>{t=null;const e=document.getElementById("pwa-install-banner");e&&e.remove(),typeof gtag=="function"&&gtag("event","pwa_app_installed",{platform:"android"}),localStorage.removeItem("pwa-banner-dismissed")}),window.matchMedia("(display-mode: standalone)").matches&&(sessionStorage.getItem("pwa-launch-tracked")||(sessionStorage.setItem("pwa-launch-tracked","true"),typeof gtag=="function"&&gtag("event","pwa_standalone_launch",{platform:"android"})))})();
