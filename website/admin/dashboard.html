<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SmartHeat Analytics Dashboard</title>
  <meta name="robots" content="noindex, nofollow">
  <link rel="stylesheet" href="dashboard.css?v=2026013010">
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <!-- Leaflet for maps -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>
  <!-- Login Modal -->
  <div id="login-modal" class="modal">
    <div class="modal-content">
      <h2>Dashboard Login</h2>
      <form id="login-form">
        <input type="password" id="password" placeholder="Password" required autofocus>
        <button type="submit">Login</button>
        <p id="login-error" class="error"></p>
      </form>
    </div>
  </div>

  <!-- Main Dashboard -->
  <div id="dashboard" class="hidden">
    <header>
      <h1>SmartHeat Intelligence</h1>
      <div class="period-selector">
        <button class="period-btn" data-days="7">7d</button>
        <button class="period-btn active" data-days="30">30d</button>
        <button class="period-btn" data-days="90">90d</button>
      </div>
    </header>

    <!-- Top Priority Alert -->
    <div id="top-priority-alert" class="top-priority hidden">
      <div class="priority-badge">TOP PRIORITY</div>
      <div class="priority-content">
        <div class="priority-title" id="priority-title">Loading...</div>
        <div class="priority-insight" id="priority-insight"></div>
      </div>
      <div class="priority-actions">
        <button class="btn-outline" id="priority-view-details">View Details</button>
      </div>
    </div>

    <!-- Summary Cards (Combined Business Metrics) -->
    <div class="cards">
      <div class="card" id="card-users">
        <div class="card-label">Total Users</div>
        <div class="card-value" id="total-users">--</div>
        <div class="card-sub" id="users-breakdown">-- iOS / -- website</div>
        <div class="card-freshness" id="users-freshness">--</div>
      </div>
      <div class="card" id="card-deliveries">
        <div class="card-label">Deliveries Logged</div>
        <div class="card-value" id="total-deliveries">--</div>
        <div class="card-sub" id="deliveries-breakdown">Real orders tracked</div>
        <div class="card-freshness" id="deliveries-freshness">--</div>
      </div>
      <div class="card" id="card-revenue">
        <div class="card-label">Est. Revenue</div>
        <div class="card-value" id="est-revenue">--</div>
        <div class="card-sub" id="revenue-breakdown">From supplier clicks</div>
        <div class="card-freshness" id="revenue-freshness">--</div>
      </div>
      <div class="card" id="card-android">
        <div class="card-label">Android Waitlist</div>
        <div class="card-value" id="waitlist-total">--</div>
        <div class="card-sub" id="waitlist-recent">+-- this week</div>
        <div class="card-freshness" id="waitlist-freshness">--</div>
      </div>
    </div>

    <!-- Alert Banner -->
    <div id="alert-banner" class="alert hidden">
      <span id="alert-text"></span>
      <a href="#" id="alert-action">View</a>
    </div>

    <!-- Tabs -->
    <nav class="tabs">
      <button class="tab active" data-tab="recommendations">Recommendations</button>
      <button class="tab" data-tab="website">Website</button>
      <button class="tab" data-tab="ios-app">iOS App</button>
      <button class="tab" data-tab="android">Android</button>
      <button class="tab" data-tab="overview">Overview</button>
      <button class="tab" data-tab="map">Map</button>
      <button class="tab" data-tab="scrapers">Data Health</button>
      <button class="tab" data-tab="suppliers">Suppliers</button>
      <button class="tab" data-tab="external">External</button>
    </nav>

    <!-- Tab Content -->
    <main class="tab-content">
      <!-- Recommendations Tab (Default View) -->
      <section id="tab-recommendations" class="tab-panel active">
        <div class="recommendations-container">
          <div id="recommendations-loading" class="loading">Generating recommendations...</div>

          <div id="recommendations-content" class="hidden">
            <!-- HIGH Priority -->
            <div class="priority-section" id="section-high">
              <h3 class="priority-header high">HIGH PRIORITY</h3>
              <div class="recommendation-cards" id="cards-high"></div>
            </div>

            <!-- MEDIUM Priority -->
            <div class="priority-section" id="section-medium">
              <h3 class="priority-header medium">MEDIUM PRIORITY</h3>
              <div class="recommendation-cards" id="cards-medium"></div>
            </div>

            <!-- LOW / OPPORTUNITY -->
            <div class="priority-section" id="section-low">
              <h3 class="priority-header low">OPPORTUNITIES</h3>
              <div class="recommendation-cards" id="cards-low"></div>
            </div>
          </div>

          <div id="no-recommendations" class="hidden">
            <p class="success-message">All systems healthy - no urgent recommendations</p>
          </div>
        </div>
      </section>

      <!-- Website Tab (GA4 Data) -->
      <section id="tab-website" class="tab-panel">
        <div class="panel-grid">
          <div class="panel">
            <h3>Sessions</h3>
            <div id="web-sessions" class="stat-large">--</div>
            <div class="hint">Total visits in period</div>
          </div>
          <div class="panel">
            <h3>Unique Visitors</h3>
            <div id="web-users" class="stat-large">--</div>
            <div class="hint">Distinct users</div>
          </div>
          <div class="panel">
            <h3>Bounce Rate</h3>
            <div id="web-bounce" class="stat-large">--%</div>
            <div class="hint">Target: &lt;60%</div>
          </div>
          <div class="panel">
            <h3>Avg. Session</h3>
            <div id="web-duration" class="stat-large">--</div>
            <div class="hint">Time on site</div>
          </div>
          <div class="panel full-width">
            <h3>Traffic Sources</h3>
            <canvas id="web-traffic-chart"></canvas>
            <div id="web-traffic-note" class="hint"></div>
          </div>
          <div class="panel full-width">
            <h3>Daily Website Activity</h3>
            <canvas id="web-daily-chart"></canvas>
          </div>
          <div class="panel">
            <h3>Top Pages</h3>
            <table id="web-pages-table">
              <thead>
                <tr>
                  <th>Page</th>
                  <th>Views</th>
                </tr>
              </thead>
              <tbody id="web-pages-body"></tbody>
            </table>
          </div>
          <div class="panel">
            <h3>Supplier Clicks</h3>
            <div id="web-clicks-summary">
              <div class="stat-row">
                <span>Total Clicks</span>
                <span id="web-total-clicks" class="stat-value">--</span>
              </div>
              <div class="stat-row">
                <span>Phone Calls</span>
                <span id="web-call-clicks" class="stat-value">--</span>
              </div>
              <div class="stat-row">
                <span>Website Visits</span>
                <span id="web-website-clicks" class="stat-value">--</span>
              </div>
            </div>
            <div class="hint" style="margin-top: 1rem;">From PostgreSQL tracking</div>
          </div>
          <div class="panel full-width" id="web-ga4-setup" style="display: none;">
            <div class="setup-guide">
              <h3>Connect Google Analytics</h3>
              <p>Enable GA4 API to see detailed website traffic data.</p>
              <ol>
                <li>Go to <a href="https://console.cloud.google.com/apis/library/analyticsdata.googleapis.com" target="_blank">Google Cloud Console</a></li>
                <li>Enable "Google Analytics Data API"</li>
                <li>Create a service account with Viewer role</li>
                <li>Download JSON credentials</li>
                <li>Set <code>GOOGLE_APPLICATION_CREDENTIALS_JSON</code> env var</li>
                <li>Set <code>GA4_PROPERTY_ID</code> env var</li>
              </ol>
              <a href="https://analytics.google.com/" target="_blank" class="btn">Open GA4 Console</a>
            </div>
          </div>
        </div>
      </section>

      <!-- Retention Tab -->
      <section id="tab-retention" class="tab-panel">
        <div class="panel-grid">
          <div class="panel">
            <h3>Week 1 Retention</h3>
            <div id="week1-retention" class="stat-large retention-stat">--%</div>
            <div class="hint">Target: 30%+</div>
          </div>
          <div class="panel">
            <h3>Active Cohort Size</h3>
            <div id="cohort-size" class="stat-large">--</div>
          </div>
          <div class="panel full-width">
            <h3>Cohort Retention Chart</h3>
            <canvas id="retention-chart"></canvas>
          </div>
          <div class="panel full-width">
            <h3>Retention by Behavior</h3>
            <p class="hint">Users who take certain actions stay longer</p>
            <table id="behavior-retention-table">
              <thead>
                <tr>
                  <th>Behavior</th>
                  <th>Users</th>
                  <th>Avg Active Days</th>
                  <th>Insight</th>
                </tr>
              </thead>
              <tbody id="behavior-retention-body"></tbody>
            </table>
          </div>
          <div class="panel full-width">
            <h3>Retention Improvement Ideas</h3>
            <div id="retention-ideas" class="ideas-list">
              <div class="idea">
                <span class="idea-icon">1.</span>
                <span>Push users to log first delivery - retained users make calls</span>
              </div>
              <div class="idea">
                <span class="idea-icon">2.</span>
                <span>Add price drop alerts to bring users back</span>
              </div>
              <div class="idea">
                <span class="idea-icon">3.</span>
                <span>Weekly "your area prices" email for opted-in users</span>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Acquisition Tab -->
      <section id="tab-acquisition" class="tab-panel">
        <div class="panel-grid">
          <div class="panel">
            <h3>Total Sessions</h3>
            <div id="acq-sessions" class="stat-large">--</div>
            <div class="hint" id="acq-sessions-source">From GA4</div>
          </div>
          <div class="panel">
            <h3>Organic %</h3>
            <div id="acq-organic" class="stat-large">--%</div>
            <div class="hint">Target: 30%+</div>
          </div>
          <div class="panel">
            <h3>Search ‚Üí Click Rate</h3>
            <div id="acq-conversion" class="stat-large">--%</div>
          </div>
          <div class="panel full-width">
            <h3>Traffic Sources</h3>
            <canvas id="traffic-sources-chart"></canvas>
            <div id="traffic-sources-note" class="hint"></div>
          </div>
          <div class="panel full-width">
            <h3>Daily Conversion Funnel</h3>
            <canvas id="acquisition-funnel-chart"></canvas>
          </div>
          <div class="panel full-width">
            <h3>Top Converting Locations</h3>
            <table id="converting-locations-table">
              <thead>
                <tr>
                  <th>ZIP</th>
                  <th>City</th>
                  <th>Searches</th>
                  <th>Clicks</th>
                  <th>Conversion</th>
                </tr>
              </thead>
              <tbody id="converting-locations-body"></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Android Decision Tab -->
      <section id="tab-android" class="tab-panel">
        <div class="panel-grid">
          <div class="panel decision-card" id="android-decision">
            <h3>Android Decision</h3>
            <div id="android-status" class="decision-status">WAIT</div>
            <div id="android-message" class="decision-message">Loading...</div>
          </div>
          <div class="panel">
            <h3>Waitlist Total</h3>
            <div id="android-waitlist" class="stat-large">--</div>
            <div class="hint">Target: 200</div>
          </div>
          <div class="panel">
            <h3>Weekly Growth</h3>
            <div id="android-growth" class="stat-large">--%</div>
            <div class="hint">Target: 5%+</div>
          </div>
          <div class="panel">
            <h3>PWA Installs</h3>
            <div id="android-pwa" class="stat-large">--</div>
            <div class="hint" id="android-pwa-rate">--% conversion</div>
          </div>
          <div class="panel full-width">
            <h3>PWA Funnel</h3>
            <div class="pwa-funnel">
              <div class="pwa-funnel-step">
                <div class="pwa-funnel-value" id="pwa-prompts">--</div>
                <div class="pwa-funnel-label">Install Prompts</div>
              </div>
              <div class="pwa-funnel-arrow">‚Üí</div>
              <div class="pwa-funnel-step">
                <div class="pwa-funnel-value" id="pwa-installs-detail">--</div>
                <div class="pwa-funnel-label">Installs</div>
              </div>
              <div class="pwa-funnel-arrow">‚Üí</div>
              <div class="pwa-funnel-step">
                <div class="pwa-funnel-value" id="pwa-launches">--</div>
                <div class="pwa-funnel-label">App Launches</div>
              </div>
            </div>
            <div class="hint" style="text-align: center; margin-top: 1rem;">PWA serves Android users until native app launches</div>
          </div>
          <div class="panel full-width">
            <h3>Website Visitors by Platform (from GA4)</h3>
            <div class="platform-breakdown" id="platform-breakdown">
              <div class="platform-item">
                <span class="platform-icon">üçé</span>
                <span class="platform-name">iOS</span>
                <span class="platform-value" id="platform-ios">--%</span>
                <span class="platform-users" id="platform-ios-users">-- users</span>
              </div>
              <div class="platform-item">
                <span class="platform-icon">ü§ñ</span>
                <span class="platform-name">Android</span>
                <span class="platform-value" id="platform-android">--%</span>
                <span class="platform-users" id="platform-android-users">-- users</span>
              </div>
              <div class="platform-item">
                <span class="platform-icon">üñ•Ô∏è</span>
                <span class="platform-name">Desktop</span>
                <span class="platform-value" id="platform-desktop">--%</span>
                <span class="platform-users" id="platform-desktop-users">-- users</span>
              </div>
            </div>
            <div class="hint" id="platform-note"></div>
          </div>
          <div class="panel full-width">
            <h3>Threshold Status</h3>
            <div class="thresholds-grid" id="thresholds-grid">
              <!-- Filled by JS -->
            </div>
          </div>
          <div class="panel full-width">
            <h3>Weekly Waitlist Trend</h3>
            <canvas id="android-trend-chart"></canvas>
          </div>
          <div class="panel full-width">
            <h3>Projection</h3>
            <div id="android-projection" class="projection-box">
              <div class="projection-item">
                <span class="projection-label">Weeks to 200:</span>
                <span class="projection-value" id="weeks-to-200">--</span>
              </div>
              <div class="projection-item">
                <span class="projection-label">Expected launch users (30% conv):</span>
                <span class="projection-value" id="expected-users">--</span>
              </div>
              <div class="projection-item">
                <span class="projection-label">Break-even threshold:</span>
                <span class="projection-value">100 active users</span>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Overview Tab -->
      <section id="tab-overview" class="tab-panel">
        <div class="overview-grid">
          <!-- Top Row: Key Metrics -->
          <div class="overview-metrics">
            <div class="metric-card">
              <div class="metric-icon">üèÜ</div>
              <div class="metric-content">
                <div class="metric-label">Top Supplier</div>
                <div class="metric-value" id="top-supplier">--</div>
              </div>
            </div>
            <div class="metric-card">
              <div class="metric-icon">üìç</div>
              <div class="metric-content">
                <div class="metric-label">Total Searched</div>
                <div class="metric-value" id="total-searched">-- ZIPs</div>
                <div class="metric-hint">Unique ZIPs in period</div>
              </div>
            </div>
          </div>

          <!-- Coverage Gap Cards -->
          <div class="coverage-cards">
            <div class="coverage-card danger clickable" id="panel-no-suppliers" title="Click to view ZIPs">
              <div class="coverage-icon">‚ö†Ô∏è</div>
              <div class="coverage-content">
                <div class="coverage-label">No Suppliers</div>
                <div class="coverage-value" id="true-coverage-gaps">-- ZIPs</div>
                <div class="coverage-hint">Users searching areas with zero coverage</div>
              </div>
              <div class="coverage-action">View List ‚Üí</div>
            </div>
            <div class="coverage-card warning clickable" id="panel-low-engagement" title="Click to view ZIPs">
              <div class="coverage-icon">üìâ</div>
              <div class="coverage-content">
                <div class="coverage-label">Low Engagement</div>
                <div class="coverage-value" id="engagement-gaps">-- ZIPs</div>
                <div class="coverage-hint">Has suppliers but no clicks yet</div>
              </div>
              <div class="coverage-action">View List ‚Üí</div>
            </div>
          </div>

          <!-- Conversion Funnel -->
          <div class="funnel-section">
            <h3>Conversion Funnel</h3>
            <div class="funnel-visual">
              <div class="funnel-step">
                <div class="funnel-bar searches-bar" id="funnel-searches-bar"></div>
                <div class="funnel-label">
                  <span class="funnel-count" id="funnel-searches">--</span>
                  <span class="funnel-name">Searches</span>
                </div>
              </div>
              <div class="funnel-arrow">‚Üí</div>
              <div class="funnel-step">
                <div class="funnel-bar clicks-bar" id="funnel-clicks-bar"></div>
                <div class="funnel-label">
                  <span class="funnel-count" id="funnel-clicks">--</span>
                  <span class="funnel-name">Clicks</span>
                </div>
              </div>
              <div class="funnel-rate">
                <span id="funnel-rate">--%</span> conversion
              </div>
            </div>
          </div>

          <!-- Price Alerts -->
          <div class="panel full-width" id="price-alerts-panel" style="display: none;">
            <h3>‚ö†Ô∏è Price Alerts</h3>
            <div id="price-alerts-content"></div>
          </div>

          <!-- Supplier Signals Table -->
          <div class="panel full-width">
            <h3>Supplier Signals</h3>
            <table id="supplier-signals-table">
              <thead>
                <tr>
                  <th>Supplier</th>
                  <th>Clicks</th>
                  <th>Price</th>
                  <th>vs Market</th>
                  <th>Est. Revenue</th>
                  <th>Signal</th>
                </tr>
              </thead>
              <tbody id="supplier-signals-body"></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Searches Tab -->
      <section id="tab-searches" class="tab-panel">
        <div class="panel-grid">
          <div class="panel">
            <h3>Total Searches</h3>
            <div id="searches-total" class="stat-large">--</div>
            <div class="hint" id="searches-avg">-- avg/day</div>
          </div>
          <div class="panel">
            <h3>Unique ZIPs</h3>
            <div id="searches-zips" class="stat-large">--</div>
          </div>
          <div class="panel full-width">
            <h3>Daily Search Volume</h3>
            <canvas id="searches-chart"></canvas>
          </div>
          <div class="panel">
            <h3>Peak Hours</h3>
            <canvas id="peak-hours-chart"></canvas>
          </div>
          <div class="panel">
            <h3>Top Searched ZIPs</h3>
            <table id="top-zips-table">
              <thead>
                <tr>
                  <th>ZIP</th>
                  <th>City</th>
                  <th>State</th>
                  <th>Searches</th>
                </tr>
              </thead>
              <tbody id="top-zips-body"></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- iOS App Tab -->
      <section id="tab-ios-app" class="tab-panel">
        <div class="panel-grid">
          <div class="panel">
            <h3>App Installs</h3>
            <div id="ios-installs" class="stat-large">--</div>
            <div class="hint">Total installs</div>
          </div>
          <div class="panel">
            <h3>Monthly Active Users</h3>
            <div id="ios-mau" class="stat-large">--</div>
            <div class="hint" id="ios-mau-percent">--% of installs</div>
          </div>
          <div class="panel">
            <h3>Week 1 Retention</h3>
            <div id="ios-retention" class="stat-large retention-stat">--%</div>
            <div class="hint">Target: 30%+</div>
          </div>
          <div class="panel">
            <h3>Deliveries Logged</h3>
            <div id="ios-deliveries" class="stat-large">--</div>
            <div class="hint">Real orders</div>
          </div>
          <div class="panel full-width">
            <h3>App Event Breakdown</h3>
            <div class="ios-events-grid" id="ios-events-grid">
              <div class="event-item">
                <span class="event-name">Supplier Selected</span>
                <span class="event-count" id="ios-event-supplier">--</span>
              </div>
              <div class="event-item">
                <span class="event-name">Price Checked</span>
                <span class="event-count" id="ios-event-price">--</span>
              </div>
              <div class="event-item">
                <span class="event-name">Directory Searched</span>
                <span class="event-count" id="ios-event-search">--</span>
              </div>
              <div class="event-item">
                <span class="event-name">No Results Shown</span>
                <span class="event-count" id="ios-event-noresults">--</span>
              </div>
            </div>
          </div>
          <div class="panel full-width">
            <h3>Daily App Engagement</h3>
            <canvas id="ios-chart"></canvas>
          </div>
          <div class="panel full-width">
            <h3>Top Suppliers in App</h3>
            <table id="ios-suppliers-table">
              <thead>
                <tr>
                  <th>Supplier</th>
                  <th>Views</th>
                  <th>Calls</th>
                  <th>Total</th>
                </tr>
              </thead>
              <tbody id="ios-suppliers-body"></tbody>
            </table>
          </div>
          <!-- Firebase Setup Guide (shown when not configured) -->
          <div class="panel full-width" id="ios-firebase-setup" style="display: none;">
            <div class="setup-guide">
              <h3>Connect Firebase Analytics</h3>
              <p>Enable Firebase API to see detailed iOS app analytics including retention cohorts, user journeys, and event funnels.</p>
              <ol>
                <li>Go to <a href="https://console.firebase.google.com/project/smartheat-e0729/settings/serviceaccounts/adminsdk" target="_blank">Firebase Console &gt; Service Accounts</a></li>
                <li>Click "Generate new private key"</li>
                <li>Download the JSON file</li>
                <li>Base64 encode it: <code>base64 -i serviceAccount.json</code></li>
                <li>Set <code>GOOGLE_APPLICATION_CREDENTIALS_JSON</code> env var with the encoded value</li>
                <li>Set <code>FIREBASE_PROJECT_ID=smartheat-e0729</code></li>
              </ol>
              <div class="setup-actions">
                <a href="https://console.firebase.google.com/project/smartheat-e0729/analytics" target="_blank" class="btn">Open Firebase Console</a>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Clicks Tab -->
      <section id="tab-clicks" class="tab-panel">
        <div class="panel-grid">
          <div class="panel full-width">
            <h3>Daily Clicks</h3>
            <canvas id="clicks-chart"></canvas>
          </div>
          <div class="panel">
            <h3>By Page Source</h3>
            <canvas id="page-source-chart"></canvas>
          </div>
          <div class="panel">
            <h3>By Device</h3>
            <canvas id="device-chart"></canvas>
          </div>
          <div class="panel full-width">
            <h3>Top Suppliers by Clicks</h3>
            <table id="clicks-by-supplier-table">
              <thead>
                <tr>
                  <th>Supplier</th>
                  <th>Calls</th>
                  <th>Websites</th>
                  <th>Total</th>
                </tr>
              </thead>
              <tbody id="clicks-by-supplier-body"></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Prices Tab -->
      <section id="tab-prices" class="tab-panel">
        <div class="panel-grid">
          <div class="panel full-width">
            <h3>Price Trends</h3>
            <canvas id="price-chart"></canvas>
          </div>
          <div class="panel full-width">
            <h3>Price Spread by State (Marketing Opportunity)</h3>
            <canvas id="spread-chart"></canvas>
            <p class="hint">Higher spread = easier marketing ("Save up to $X/gal!")</p>
          </div>
          <div class="panel full-width">
            <h3>Current Prices by Supplier</h3>
            <table id="prices-table">
              <thead>
                <tr>
                  <th>Supplier</th>
                  <th>State</th>
                  <th>Price</th>
                  <th>Last Updated</th>
                </tr>
              </thead>
              <tbody id="prices-body"></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Map Tab -->
      <section id="tab-map" class="tab-panel">
        <div class="panel full-width">
          <h3>Demand Heatmap & Coverage Gaps</h3>
          <div id="map-stats" class="map-legend"></div>
          <div id="map-container"></div>
        </div>
        <div class="panel full-width">
          <h3>Supplier Clicks by Location</h3>
          <table>
            <thead>
              <tr>
                <th>ZIP</th>
                <th>City</th>
                <th>County</th>
                <th>State</th>
                <th>Clicks</th>
              </tr>
            </thead>
            <tbody id="geo-clicks-body"></tbody>
          </table>
        </div>
      </section>

      <!-- Scrapers Tab -->
      <section id="tab-scrapers" class="tab-panel">
        <div class="panel-grid">
          <div class="panel">
            <h3>Last Scrape Run</h3>
            <div id="last-scrape" class="stat-large">--</div>
          </div>
          <div class="panel">
            <h3>Suppliers Scraped</h3>
            <div id="suppliers-scraped" class="stat-large">--</div>
          </div>
          <div class="panel full-width">
            <h3>Stale Suppliers (No update in 48h)</h3>
            <table id="stale-table">
              <thead>
                <tr>
                  <th>Supplier</th>
                  <th>Last Price</th>
                  <th>Last Updated</th>
                  <th>Website</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody id="stale-body"></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Suppliers Tab -->
      <section id="tab-suppliers" class="tab-panel">
        <div class="panel full-width">
          <div class="filters">
            <select id="filter-state">
              <option value="">All States</option>
            </select>
            <select id="filter-price">
              <option value="">All Price Status</option>
              <option value="true">Has Price</option>
              <option value="false">No Price</option>
            </select>
            <select id="filter-scrape">
              <option value="">All Scrape Status</option>
              <option value="enabled">Enabled</option>
              <option value="disabled">Disabled</option>
              <option value="stale">Stale</option>
            </select>
            <input type="text" id="filter-search" placeholder="Search...">
            <button id="filter-apply">Apply</button>
          </div>
          <table id="suppliers-table">
            <thead>
              <tr>
                <th>Supplier</th>
                <th>State</th>
                <th>Price</th>
                <th>Updated</th>
                <th>Clicks (7d)</th>
                <th>Status</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="suppliers-body"></tbody>
          </table>
          <div class="pagination">
            <button id="prev-page" disabled>Previous</button>
            <span id="page-info">Page 1</span>
            <button id="next-page">Next</button>
          </div>
        </div>
      </section>

      <!-- External Tab -->
      <section id="tab-external" class="tab-panel">
        <div class="panel-grid">
          <div class="panel">
            <h3>Firebase Analytics (iOS App)</h3>
            <p>View detailed iOS app analytics including supplier_selected, delivery_logged, and other custom events.</p>
            <a href="https://console.firebase.google.com/project/smartheat-e0729/analytics" target="_blank" class="btn">Open Firebase Console</a>
          </div>
          <div class="panel">
            <h3>Google Analytics 4 (Website)</h3>
            <p>View website traffic, user behavior, and conversion data.</p>
            <a href="https://analytics.google.com/" target="_blank" class="btn">Open Google Analytics</a>
          </div>
          <div class="panel">
            <h3>Google Search Console</h3>
            <p>Monitor search performance, indexing status, and SEO issues.</p>
            <a href="https://search.google.com/search-console" target="_blank" class="btn">Open Search Console</a>
          </div>
        </div>
      </section>
    </main>

    <!-- Supplier Edit Modal -->
    <div id="supplier-modal" class="modal hidden">
      <div class="modal-content wide">
        <h2>Edit Supplier: <span id="edit-supplier-name"></span></h2>
        <form id="supplier-form">
          <input type="hidden" id="edit-supplier-id">

          <fieldset>
            <legend>Basic Info</legend>
            <div class="form-row">
              <label>Name</label>
              <input type="text" id="edit-name" required>
            </div>
            <div class="form-row">
              <label>Phone</label>
              <input type="tel" id="edit-phone">
            </div>
            <div class="form-row">
              <label>Website</label>
              <input type="url" id="edit-website">
            </div>
            <div class="form-row">
              <label>State</label>
              <input type="text" id="edit-state" maxlength="2">
            </div>
            <div class="form-row">
              <label>City</label>
              <input type="text" id="edit-city">
            </div>
          </fieldset>

          <fieldset>
            <legend>Display Settings</legend>
            <div class="form-row checkbox">
              <label><input type="checkbox" id="edit-active"> Show in directory</label>
            </div>
            <div class="form-row checkbox">
              <label><input type="checkbox" id="edit-price-display"> Allow price display</label>
            </div>
            <div class="form-row checkbox">
              <label><input type="checkbox" id="edit-scraping"> Scraping enabled</label>
            </div>
          </fieldset>

          <fieldset>
            <legend>Price Info</legend>
            <div class="form-row">
              <label>Current Price ($)</label>
              <input type="number" id="edit-price" step="0.01" min="0" max="10" placeholder="e.g. 3.49">
              <small class="hint">Leave blank to use scraped price</small>
            </div>
            <div class="form-row">
              <label>Last Updated</label>
              <input type="text" id="edit-price-date" readonly class="readonly-field">
            </div>
            <div class="form-row">
              <label>Price Source</label>
              <input type="text" id="edit-price-source" readonly class="readonly-field">
            </div>
          </fieldset>

          <fieldset>
            <legend>Click Stats (7 days)</legend>
            <div id="edit-click-stats" class="stats-grid"></div>
          </fieldset>

          <div class="form-actions">
            <button type="button" id="cancel-edit" class="btn-secondary">Cancel</button>
            <button type="submit" class="btn-primary">Save Changes</button>
          </div>
        </form>
      </div>
    </div>

    <!-- ZIP Details Modal -->
    <div id="zip-details-modal" class="modal hidden">
      <div class="modal-content wide">
        <h2 id="zip-details-title">ZIP Details</h2>
        <div id="zip-details-content">
          <p>Loading...</p>
        </div>
        <div class="form-actions">
          <button type="button" id="close-zip-details">Close</button>
        </div>
      </div>
    </div>
  </div>

  <script src="dashboard.js?v=2026013010"></script>
</body>
</html>
